# Fix Summary: Proxy Empty Response - Glider Timeout & Dial Issues

## Problem
Users experienced empty responses when using proxies through the HTTP/SOCKS5 endpoints. The Docker logs showed repeated `i/o timeout` errors from glider when attempting to connect to backend SS/VMess nodes:
```
glider[36a93ce9]: 2025/10/30 02:06:20 client.go:34: [ss] dial to ct2.xcone.xyz:43903 error: dial tcp :0->61.172.167.170:43903: i/o timeout
```

## Root Cause
Glider's default connection timeout (3 seconds) was too short for establishing connections to remote proxy nodes, especially:
- Free proxy nodes with high latency
- Nodes located far from the server
- Nodes with unstable network conditions

## Solution
Added configurable timeout parameters for glider processes with sensible defaults:

### New Environment Variables
| Variable | Default | Description |
|----------|---------|-------------|
| `GLIDER_DIAL_TIMEOUT` | 10 | Connection timeout to backend proxies (seconds) |
| `GLIDER_RELAY_TIMEOUT` | 30 | Data relay/forwarding timeout (seconds), 0 to disable |
| `GLIDER_CHECK_TIMEOUT` | 8 | Health check timeout (seconds) |
| `GLIDER_MAX_FAILURES` | 2 | Number of failures before marking node unavailable |

### Code Changes
1. **proxychain/config.py**: Added 4 new timeout configuration fields with validation
2. **proxychain/glider_manager.py**: Updated `_build_config()` to include timeout parameters in generated glider configs
3. **README.md**: Added documentation for new environment variables and troubleshooting guidance
4. **docker-compose.yml**: Added commented examples of timeout configuration

## Testing
Created `test_timeout_config.py` to verify:
- ✓ Default values load correctly
- ✓ Environment variables override defaults
- ✓ Generated glider configs include all timeout settings
- ✓ Relay timeout can be disabled (set to 0)

All tests pass successfully.

## Usage Example

### Docker Compose
```yaml
environment:
  - GLIDER_DIAL_TIMEOUT=15    # Increase dial timeout to 15 seconds
  - GLIDER_RELAY_TIMEOUT=60   # Increase relay timeout to 60 seconds
  - GLIDER_CHECK_TIMEOUT=10   # Increase health check timeout to 10 seconds
```

### Local Deployment
```bash
export GLIDER_DIAL_TIMEOUT=15
export GLIDER_RELAY_TIMEOUT=60
uvicorn proxychain.main:app --host 0.0.0.0 --port 8000
```

## Generated Config Example
```conf
# Auto-generated by proxychain
verbose=true
listen=socks5://0.0.0.0:25000
strategy=rr
dialtimeout=10
maxfailures=2
relaytimeout=30
check=http://www.msftconnecttest.com/connecttest.txt#expect=200
checkinterval=60
checktimeout=8
forward=ss://aes-256-gcm:password@example.com:8388
```

## Impact
- **Improved reliability**: Longer timeouts give valid nodes more time to respond
- **Reduced false negatives**: Slower but working nodes are no longer prematurely marked as failed
- **User control**: Administrators can tune timeouts based on their specific network conditions
- **Better defaults**: Out-of-the-box experience improved with 10s dial timeout (vs. 3s default)

## Important Notes
1. **Trade-offs**: 
   - Higher timeouts = more patient waiting for slow/dead nodes
   - Lower timeouts = faster failure detection but may miss slow nodes
   
2. **Free nodes**: Even with increased timeouts, free proxy nodes are inherently unreliable. Consider using paid subscriptions or self-hosted nodes for production use.

3. **Network diagnostics**: If issues persist, check:
   - Backend node availability (test with `curl` or `ping`)
   - Firewall rules allowing outbound connections
   - DNS resolution for node hostnames

## Files Modified
- `proxychain/config.py` (+18 lines)
- `proxychain/glider_manager.py` (+10 lines)
- `README.md` (+17 lines)
- `docker-compose.yml` (+4 lines)

## Files Added
- `CHANGELOG_fix_timeout.md` (detailed changelog)
- `test_timeout_config.py` (test suite)
- `FIX_TIMEOUT_SUMMARY.md` (this file)

## Verification Commands
```bash
# Test default configuration
python3 -c "from proxychain.config import Settings; s = Settings(); \
  print(f'dial={s.glider_dial_timeout}s, relay={s.glider_relay_timeout}s')"

# Test environment override
GLIDER_DIAL_TIMEOUT=20 python3 -c "from proxychain.config import Settings; \
  print(Settings().glider_dial_timeout)"

# Run full test suite
python3 test_timeout_config.py

# Start service and verify glider configs
LOG_LEVEL=DEBUG uvicorn proxychain.main:app --host 0.0.0.0 --port 8000
```
